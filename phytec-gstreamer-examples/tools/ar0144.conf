CAM_PHYCAM_NAME="VM-016 / VM-116"

camera_select_format_interactive() {

	echo "Select Camera Sensor Format for VM-016 / VM-116"
	echo "==============================================="

	if [ "$CAM_COLOR" = "COL" ] ; then
		echo "	1 = SGRBG8_1X8"
		echo "	2 = SGRBG10_1X10"
		echo "	3 = SGRBG12_1X12"

		read FMT_INDEX
		echo ""

		if [ -z "$FMT_INDEX" ] ; then
			CAM_FMT="SGRBG8_1X8"
		else
			case $FMT_INDEX in
				"1") CAM_FMT="SGRBG8_1X8" ;;
				"2") CAM_FMT="SGRBG10_1X10" ;;
				"3") CAM_FMT="SGRBG12_1X12" ;;
				*) echo "Invalid format selection" ; exit 1 ;;
			esac
		fi
	else
		echo "	1 = Y8_1X8"
		echo "	2 = Y10_1X10"
		echo "	3 = Y12_1X12"

		read FMT_INDEX
		echo ""

		if [ -z "$FMT_INDEX" ] ; then
			CAM_FMT="Y8_1X8"
		else
			case $FMT_INDEX in
				"1") CAM_FMT="Y8_1X8" ;;
				"2") CAM_FMT="Y10_1X10" ;;
				"3") CAM_FMT="Y12_1X12" ;;
				*) echo "Invalid format selection" ; exit 1 ;;
			esac
		fi

	fi

	format_configure $CAM_FMT
}

camera_select_format() {

	if [ -z "$1" ] ; then
		if [ "$CAM_COLOR" = "COL" ] ; then
			CAM_FMT="SGRBG8_1X8"
		else
			CAM_FMT="Y8_1X8"
		fi
	else
		CAM_FMT=$1
	fi

	format_configure $CAM_FMT

}

format_configure() {

	if [ -z "$1" ] ; then
		echo "No Format selected to configure"
		exit 1
	fi

	case $1 in
		"SGRBG8_1X8")
			CAP_FMT="GRBG"
			YAVTA_FMT="SGRBG8"
			GST_FMT="video/x-bayer,format=grbg"
			GST_CONV="bayer2rgbneon"
			;;
		"SGRBG10_1X10")
			CAP_FMT="BA10"
			YAVTA_FMT="SGRBG10"
			GST_FMT=""
			GST_CONV="bayer2rgbneon"
			;;
		"SGRBG12_1X12")
			CAP_FMT="BA12"
			YAVTA_FMT="SGRBG12"
			GST_FMT=""
			GST_CONV="bayer2rgbneon"
			;;
		"Y8_1X8")
			CAP_FMT="GREY"
			YAVTA_FMT="Y8"
			GST_FMT="video/x-raw,format=GRAY8"
			GST_CONV="queue ! videoconvert n-threads=4"
			;;
		"Y10_1X10")
			CAP_FMT="Y10"
			YAVTA_FMT="Y10"
			GST_FMT=""
			GST_CONV="queue ! videoconvert n-threads=4"
			;;
		"Y12_1X12")
			CAP_FMT="Y12"
			YAVTA_FMT="Y12"
			GST_FMT=""
			GST_CONV="queue ! videoconvert n-threads=4"
			;;
		*) echo "Unsupported Sensor Format: $1" ; exit 1
	esac

	CTRLS=""
	CTRLS="${CTRLS},auto_exposure=0"
	CTRLS="${CTRLS},autogain_analogue=1"

	if [ "$CAM_COLOR" = "COL" ] ; then
		CTRLS="${CTRLS},digital_gain_red=1300"
		CTRLS="${CTRLS},digital_gain_blue=1500"
		CTRLS="${CTRLS},digital_gain_green_red=1000"
		CTRLS="${CTRLS},digital_gain_green_blue=1000"
	fi

	# Remove leading comma, if one exists.
	CAM_FMT_CTRLS="${CTRLS##,}"
}

camera_select_mode_interactive() {

	echo ""
	echo "Select Camera Mode for VM-016 / VM-116"
	echo "======================================"
	echo "	1 = 1280 x 800 Full"
	echo "	2 = 1280 x 720 HD, with ROI"
	echo "	3 = 640  x 480 VGA, with ROI"
	echo "	4 = 640  x 400 with Skip2"
	echo "	5 = 640  x 400 with Skip2 and Binning (col/row average)"
	echo "	6 = 640  x 400 with Skip2 and Binning (col summed / row average)"

	read MODE
	echo ""

	if [ -z "$MODE" ] ; then
		MODE="1"
	fi

	mode_configure $MODE

}

camera_select_mode() {

	case "$1" in
	"Full" | "Default")
		MODE="1"
		;;
	"FullHD" )
		echo "	1 MPix Camera ${CAM_PHYCAM_NAME} does not support FullHD,"
		echo "	using 1280x720 HD instead"
		MODE="2"
		;;
	"HD" )
		MODE="2"
		;;
	"Dual" )
		MODE="4"
		;;
	* )
		MODE="$1"
		;;
	esac

	mode_configure $MODE
}

mode_configure() {

	if [ -z "$1" ] ; then
		echo "No Mode selected to configure"
		exit 1
	fi

	CAP_FRAME_CNT="8"
	GST_SRC_OPTS=""

	CTRLS=""
	case $1 in
	"1" | "")
		CAM_MODENAME="1280x800 Full"
		CAM_WIDTH="1280"
		CAM_HEIGHT="800"
		CAM_OFFSET_TOP="4"
		CAM_OFFSET_LEFT="0"
		CAP_WIDTH="1280"
		CAP_HEIGHT="800"
		CTRLS="${CTRLS},row_binning=0,col_binning=0"
		CTRLS="${CTRLS},auto_exposure_max=800"
		;;
	"2")
		CAM_MODENAME="1280x720 HD"
		CAM_WIDTH="1280"
		CAM_HEIGHT="720"
		CAM_OFFSET_TOP="44"
		CAM_OFFSET_LEFT="0"
		CAP_WIDTH="1280"
		CAP_HEIGHT="720"
		CTRLS="${CTRLS},row_binning=0,col_binning=0"
		CTRLS="${CTRLS},auto_exposure_max=720"
		;;
	"3")
		CAM_MODENAME="640x480 VGA"
		CAM_WIDTH="640"
		CAM_HEIGHT="480"
		CAM_OFFSET_TOP="164"
		CAM_OFFSET_LEFT="320"
		CAP_WIDTH="640"
		CAP_HEIGHT="480"
		CTRLS="${CTRLS},row_binning=0,col_binning=0"
		CTRLS="${CTRLS},auto_exposure_max=480"
		;;
	"4")
		CAM_MODENAME="640x400 ROI with Skipping x2"
		CAM_WIDTH="1280"
		CAM_HEIGHT="800"
		CAM_OFFSET="(0,4)"
		CAM_OFFSET_TOP="4"
		CAM_OFFSET_LEFT="0"
		CAP_WIDTH="640"
		CAP_HEIGHT="400"
		CTRLS="${CTRLS},row_binning=0,col_binning=0"
		CTRLS="${CTRLS},auto_exposure_max=800"
		;;
	"5")
		CAM_MODENAME="640x400 ROI with Skipping x2 and Binning (col/row average)"
		CAM_WIDTH="1280"
		CAM_HEIGHT="800"
		CAM_OFFSET_TOP="4"
		CAM_OFFSET_LEFT="0"
		CAP_WIDTH="640"
		CAP_HEIGHT="400"
		CTRLS="${CTRLS},row_binning=1,col_binning=1"
		CTRLS="${CTRLS},auto_exposure_max=800"
		;;
	"6")
		CAM_MODENAME="640x400 ROI with Skipping x2 and Binning (col summed / row average)"
		CAM_WIDTH="1280"
		CAM_HEIGHT="800"
		CAM_OFFSET_TOP="4"
		CAM_OFFSET_LEFT="0"
		CAP_WIDTH="640"
		CAP_HEIGHT="400"
		CTRLS="${CTRLS},row_binning=1,col_binning=2"
		CTRLS="${CTRLS},auto_exposure_max=800"
		;;
	*)	echo "Invalid mode selected: ${MODE}" ; exit 1
	esac

	# Remove leading comma, if one exists.
	CAM_MODE_CTRLS=${CTRLS##,}
}
